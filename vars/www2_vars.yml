---

# WWW2 VARS
# ----------------------------------------------------------------------------------
service_name: 'www2'

# for Stouts.users
users_enabled: yes
users_to_install:
    - 'nmaekawa'
    - 'lduarte'
    - 'hxops'

# for nmaekawa.apt
apt_required_packages:
    - 'build-essential'
    - 'libffi-dev'
    - 'openssl'
    - 'libcurl4-openssl-dev'
    - 'python3-pip'
    - 'python3-dev'
    - 'python3-setuptools'
    - 'python3-passlib'
    - 'awscli'
    - 'jq'

redirect_error_to: '{{ lookup("env", "WWW2_PROXY_TO") | mandatory }}'

# bak cronjob
cronjob_owner: 'www-data'

# NGINX VARS
# ----------------------------------------------------------------------------------

static_dir_root: '/var/www'
static_dir: '{{ static_dir_root }}/html'
# special case for vagrant
vagrant_webserver_dns: '{{ inventory_hostname }}'

# beware that order of location matter in nginx matching rules!
# for now, webdav servers should always have location '/'
# for now, do not set webdav and static location in same nginx server
# beware that nginx role concats location.root + location.prefix to create
#   the directory where static files should exist
nginx_auth_basic_user_dir: '/etc/nginx'
webdav_user_dir: '{{ local_certs_dir }}/{{ service_cert_name }}'
nginx_servers:
  - nginx_template_path: roles/nginx/templates/webserver.j2
    service_server_name: '{{ service_name }}_static'
    nginx_nonssl_port: 80
    nginx_ssl_port: 443
    locations:
      - prefix: '/certificates'
        root: '{{ static_dir }}'
        is_webdav: 'no'
      - prefix: '/srts'
        root: '{{ static_dir }}'
        is_webdav: 'no'

  - nginx_template_path: roles/nginx/templates/webserver.j2
    service_server_name: '{{ service_name }}_webdav'
    nginx_nonssl_port: 5080
    nginx_ssl_port: 5443
    locations:
      - prefix: '/'
        root: '{{ static_dir }}'
        is_webdav: 'yes'
        auth_basic_user_filepath: '{{ nginx_auth_basic_user_dir }}/.{{ service_name }}_creds'
        webdav_users: "{% if ec2_tag_cluster == 'vagrant' %}\
              [{'usr': 'user', 'pwd': 'password'}]\
          {% else %}\
              {{ lookup('file', webdav_user_dir + '/.' + service_name + '_creds') | from_json }}\
          {% endif %}"


